<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>位置情報確認</title>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { SUPABASE_URL, SUPABASE_KEY } from "./config.js";

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    if (!id) {
      document.body.innerHTML = "<p>IDが指定されていません。</p>";
    } else {
      fetchLocation(id);
    }

    async function fetchLocation(id) {
      const { data, error } = await supabase
        .from("locations")
        .select("*")
        .eq("id", id)
        .single();

      if (error || !data) {
        document.body.innerHTML = "<p>データが見つかりません。</p>";
      } else {
        const { latitude, longitude } = data;
        document.body.innerHTML = `
          <h3>現在地情報</h3>
          <p>緯度: ${latitude}</p>
          <p>経度: ${longitude}</p>
          <iframe
            width="100%"
            height="400"
            style="border:0; margin-top:10px;"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps?q=${latitude},${longitude}&output=embed">
          </iframe>
        `;
      }
    }
  </script>
</head>
<body>
  <h2>位置情報を読み込み中...</h2>
</body>
</html>
